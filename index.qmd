---
title: Introduction to Sockeye
author: Tony Liang
institute: University of British Columbia
data: 2023-09-27
engine: knitr
css: 
  - materials/sockeye.css
format:
  revealjs:
    #slide-level: 2
    template-partials:
      - title-slide.html
    slide-number: c/t
    embed-resources: true
    width: 1600
    height: 900
    mouse-wheel: true
    theme:
      #- simple
      #- serif 
      #- default
      - sockeye.scss
    output-file: index.html # naming other stuff, gh complains
    transition: fade
    transition-speed: default # or fast or slow
---

## Land acknowledgement

<!----------------------------Two column section------------------------------------>
:::: {.columns}

::: {.column width="70%"}
**I would like to acknowledge that I work on the traditional, ancestral, and unceded territory of the Coast Salish Peoples, including the territories of the xwməθkwəy̓əm (Musqueam), Skwxwú7mesh (Squamish), Stó:lō and Səl̓ílwətaʔ/Selilwitulh (Tsleil- Waututh) Nations.**

*Traditional*: Traditionally used and/or occupied by Musqueam people

*Ancestral*: Recognizes land that is handed down from generation to generation

*Unceded*: Refers to land that was not turned over to the Crown (government) by a treaty or other agreement

:::

::: {.column width="30%"}

![](materials/img/land_acknowledgement.gif)

:::

::::


## Setup VSCode

Checkout the instruction of your right platform below:

<!------------------------- Panel Tab for setup-------------------------------->


:::: {.panel-tabset}

### MacOs

Open this **[link](https://code.visualstudio.com/sha/download?build=stable&os=darwin-universal)** to download, once it is finished:

1. Open the downloaded `VSCode-darwin-universal.zip` file
2. Move the extracted VS Code app from `Downloads` to `Applications` (Located to your left under `Favorites`)
3. Launch VS Code and open the `Command Palette` by `Cmd + Shift + P`
4. Type `shell command`
5. Select the option: **Install `code` command in PATH**
6. Restart your terminal and try entering: `code --version` to confirm successful installation


### Windows

Open this **[link](https://code.visualstudio.com/sha/download?build=stable&os=win32-x64-user)** to download.

:::: {.columns}

::: {.column width="50%"}

Run the installer, accept default config except:

 - **On Select Additional Tasks**
    - Add 'Open with Code action to Windows file context menu'
    - Add ‘Open with Code’ action to Windows directory context menu”
    - Register Code as an editor for supported file types
    - Add to PATH (should be selected by default)

:::

::: {.column width="50%"}

<!-- ![](materials/img/windows_vsc.png){.absolute top=225 right=25 width="750" height="600"} -->
![](materials/img/windows_vsc.png){.absolute top=275 right=25 width="750" height="600"}

:::

::::


::::


## Connecting to Sockeye

::::: {.columns}

:::: {.column width="52%"}

::: {.callout-note}

You need to have a UBC IP address in order to access to the server by connecting to *eduroam* or 
*ubcsecure*

:::

Login to sockeye with the `ssh` command:
```{bash}
#| include: true
#| eval:  false
#| echo:  true
#| code-line-numbers: true
ssh cwl@sockeye.arc.ubc.ca
```


::: {.incremental}
- `cwl` is your campus wide login

- password is your same CWL password

- `sockeye.arc.ubc.ca` is the server address

- you also need Two-Factor Authentication [2FA]{.secondary}

:::

::::

:::: {.column width="48%"}

![](materials/img/sockeye_login.png){.absolute top=0 right=25 width="650" height="800"}

::::

:::::

## Alternative way connecting to Sockeye

<!-- ::: {.callout-tip}

You probably tired of typing password over and over to login to server, we could make more use of `ssh`

::: -->

:::: {.columns}

::: {.column width="60%"}

::: {.incremental}

1. Generate new  `ssh` key pair credentials in your local
2. Add the [public]{.secondary} key to the server-side
3. Add your server login info into `~/.ssh/config` in your local
4. Login with `ssh <new_alias>`
  
:::

:::

::: {.column width="40%"}

::: {.fragment .fade-in-then-semi-out}

Generate a new `ssh` key pair 

```{bash}
#| include: true
#| eval:  false
#| echo:  true
#| code-line-numbers: true
ssh-keygen -t rsa
```

- Follow default by prompting `Enter`
- Passphrase optional
- Two keys generated:
  * one public (`id_rsa.pub`)
  * one [private]{.third} (`id_rsa`)

:::

:::

::::

. . .

::: {.callout-caution}

Keep the [private]{.third} key safe and for your use only

:::

## Alternative way connecting to Sockeye
Add your **public** key to the server

::: {.panel-tabset}

### Bash/Zsh

```{bash}
#| eval:  false
#| echo: true
#| code-line-numbers: "2"
# Need to replace cwl!
ssh-copy-id -i ~/.ssh/id_rsa.pub
```

### Powershell

```{bash}
#| eval:  false
#| echo: true
#| code-line-numbers: "2"
#| code-overflow: scroll
# Need to replace cwl!
type $env:USERPROFILE\.ssh\id_rsa.pub | ssh cwl@sockeye.arc.ubc.ca "cat >> .ssh/authorized_keys"
```

:::


::: {.fragment .fade-up}

:::: {.columns}

::: {.column width="70%"}

Use any editor to create `~/.ssh/config` and enter the following:
```{bash}
#| eval:  false
#| echo:  true
#| code-line-numbers: "|2|3|4|2-4"
# Note these indent matters
Host  arc # or another alias you like
  HostName sockeye.arc.ubc.ca
  User cwl # replace your cwl
```

:::

::: {.column width="30%"}

<br>


- [Host = User@Hostname]{.secondary}
- Multiple configuration (multiple servers)
- More options available , look at [here](https://www.ssh.com/academy/ssh/config)

:::

::::

:::

::: aside

If you feel instructions unclear, follow this [guide](https://tonyliang19.github.io/arc-sockeye/#41)

:::


## Sockeye 

```{bash}
#| code-line-numbers: true
#| eval:  false
#| echo:  true
# If you followed earlier configuration correctly
ssh arc # otherwise ssh cwl@sockeye.arc.ubc.ca
```

::: {.incremental}

- Upon login, you land on the `login` node and spend most time here
- Use it to run [large]{.secondary} computational works
- Whenever you're ready, you submit `batch` jobs to server
- You can log out and leave a job running
- Runs with `PBS`, changing to `SLURM`^[Please see [here](https://confluence.it.ubc.ca/display/UARC/PBS+to+Slurm+Migration+-+What+to+expect) for more info.] soon


:::

. . .

::: {.callout-tip}

We also have a recorded session from past months, if you're interested please contact Amrit

:::

:::{.aside}
Sockeye is named after the Sockeye salmon (Oncorhyncus nerka), native to the Northern Pacific Ocean and the rivers discharging into it.
:::

---

![](materials/img/arc-structure.jpg)


## Directories on Sockeye

:::: {.columns}

::: {.column width="50%"}

![](materials/img/arc-dir.png)

:::

::: {.column width="50%"}

![](materials/img/ro-dir.png)

:::

::::

::: {.callout-tip}

Remember that `read/write` access matters! You clearly don't want to spend hours fitting models, but failed to write any results, cause you forgot to specify it to be the **scratch** directory.

:::
## Another Slide here

New slide, should have a pause 

<!---
space matters here ". . ."
means to show thing later after this
--->

. . . 

Show later

## Terminal

:::: {.columns}

::: {.column width="40%"}

This is left column

:::

::: {.column width="60%"}

This is right column

:::

::::

## Yet another slide with tabsets

wow
